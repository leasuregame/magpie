2014-1-25 ~ 2014-2-8
1. 已领取了某个好友的祝福次数不同步
2、服务器所有请求添加内置CD（对计算强度大的请求加入内置CD）
5、确认是否可以多区同时登录（修改为不可多区同时在线）
6、拿消息优化，改成数据库操作，先按可操作，后按时间
8、服务器刚开启时可以正常stop，运行一段时间后不能正常stop
9、好友在线状态，在就是亮的，不在就是灰掉的。这个最好能把竞技界面里那些在线与否的状态也做进去。
[done] 10、后续的服务器，去掉机器人。（下个服务器不添加）
[done] 11、删除好友时，服务端要清除掉所有信息。 
[done] 13、GM里，奖励发放所缺类型补上，现在我们的GM发放页面不全，活力，灵气这些都没有的，要补上
[done] 14、成就里，参数修改了，对那些参数有变化的，重置一下服务端的标记。
15、没有机器人的时候，第一个进入竞技场错误
[done] 16. 同意好友请求时，对方好友已达上限，需修改消息的状态为已处理。
[tested] [done] 17. 兑换的五星卡没有记录到成就。
[tested] [done] 18、进阶调整。 
    四星进五星，前10张卡牌必然进阶不成功。

    失败时，新增的额外概率保留一半，作为下次进阶的起始概率。记录4个概率1进2，2进3，3进4，4进5，新增概率*0.5
    如：
      第一次用10张四星卡牌进阶，概率位40%，失败！保留新增概率的一半 20%
      第二次用一张四星卡牌，则概率为 40% * 0.5 + 4% = 24%，失败！保留新增概率的一半 2%，则初始四星升阶的初始概率为 20% + 2% = 22%
      第三次用一张四星卡牌，则概率为 26%，若失败 则初始概率变为24%，若成功 则初始概率置为 0
      以此类推。。。

  增加一个接口来获取进阶的初始概率， area.trainHandler.startUpgradeInitRate
  player 表增加一个字段 initRate 保存卡牌进阶的初始概率，默认初始概率都为0，如：
  initRate = {
    star1: 0,
    star2: 10,
    star3: 0,
    star4: 20
  }
  卡牌进阶时，更新对应星级的初始概率
  升阶成功后，对应星级的初始概率置为0

[tested] [done] 19、首冲奖励
     648元：首冲3倍奖励
     其他每种类型：首冲2倍奖励。
     每种类型，只有首冲才有对应奖励。
     购买之后，这个特效消失。

登陆时，有第一次的事项才返回第一次字段。（需修改）

20、抽卡抽到相同的卡。暂时从程序上做限制，抽到5星卡的时候，做个判断，如果有相同的卡， 则给予不一样的。如果玩家抽取到了游戏内全部的5星卡，那就走基本规则。
21. 春节活动充值奖励信息推送，改为有可领的而且还没领取的奖励时才推送。
22. 同步推sdk升级到3.1后，充值回调接口新增tborder字段，需修改MD5生成函数，否则无法回调成功

2014-1-22

done 删除好友时，要删除好友相关的消息

done cdkey end data check should be correct!

2014-1-20


done 1：周卡月卡功能。
月卡，售价，30元。在充值界面购买。
每天登陆可领取100魔石。到时候会在活动界面做一个专门的月卡/周卡每日奖励领取，会在那里，点击领取。后期可开补领，和补签一样界面形式，不过现在不做。
记录购买生效后的天数。

周卡，售价，6元，一周内，每天可领取60魔石。不登陆就浪费掉。参考天天爱西游。
购买后有领取期限。


没有购买状态下的显示内容
月卡：首次333魔石，每日返还100魔石 
周卡：首次66魔石，每日返还60魔石

购买后显示：
月卡：每日登陆可领取100魔石*30天
      距离下次购买：XX天

周卡：每日登陆可领取60魔石*7天
      距离下次购买：XX天

和天天爱西游显示方式相同。


done 2：新年活动，充值送礼。

每天登陆，即可领取20魔石。

活动时间：1月28--2月28.

活动期间，累计充值金额达到一定程度，就可领取额外大礼包。
每人，每个礼包，在活动期间，只能领取一次。

比如：充值达到150，那么他可以同时领取50和150的这2个礼包，以此类推。

累计充值达到66元： 领取：20000仙币，100活力，2卡魂

累计充值达到266元：领取：50000仙币，200活力，3卡魂

累计充值达到566元：领取：80000仙币，300活力，5卡魂

累计充值达到999元：领取：100000仙币，800活力，8卡魂

累计充值达到1888元：领取：200000仙币，1000活力，12卡魂


3：掉线回档+无限掉线。

4：重连方式修改，不要黑幕，不要确认提示框，只转圈。

done 5：首次高级魔石10连抽，必得5星卡1张。
每次高级10连抽，必得卡魂1个，1%概率额外获得卡魂1个。

单次和10连抽一样，只修改卡魂获得规则。

单词和10连抽分开。


done 需验证 6：好友祝福有问题。次数不同步。

7：掉线后，重新连接，开始游戏，如果刚好服务器连上了，进入游戏，那么这时候整个客户端死掉了。整个界面全部死掉了。

done 需验证 8：拥有20个好友这个成就无法达成。在25个的时候可以达成。

9：好友一直有感叹号，但实际没有认可可祝福或者领取的次数。重新登陆就没有了。

done 10：之前领取过的系统奖励，已领取。第二天又出现该消息了。显示领取，但实际不可领取。

13：洗练的时候，仙币不足，提示魔石不足。

done 14：竞技里的玩家排名的那个名字间隔排序，修改下。---因为要考虑到玩家少的情况。
　10000名开外	106名1个位次		
　9999-7000	83名1个位次		
　6999-5000	62名1个位次		
　4999--3000	26名1个位次		
　2999-1000	15名1个位次		
　999-700	7名1个位次		
　699-300	3名1个位次		
　299-199  	2名1个位次		
　199-1	        1名1个位次		

15：同时加好友，消息里客户端显示需要同步。

done 16：删除好友时，服务端要清除掉所有信息。

done 16：寻宝次数上限，修改为50次。

     -- 修改daily_gift配置表

done 17：阵型加入竞技界面，玩家可以在竞技界面直接调整自己的阵型。

done 18：反击的按钮调整一点，现在曾击败你，有点溢出。

19：元神升级的时候，把加成数字做成一个动态效果。

20：战败奖励会减半，这个看看能容得下不。在竞技界面里。

21：查询里，把对方的竞技信息也加上去。

dailyGift error result in issues: 
11：体力值可以重复领取的问题。点击领取，客户端死掉，但实际已经领取了。重新登陆，还可以继续领取。

12：好友列表不能刷新出来了，重新登录也是这样。


2014-1-10

1：激活码去掉大小写。统一大写。 -- done

2：开服之前如果时间还没到，给予一个提示信息。10点。
请您稍候，服务器将在XX点准时开启。 -- done

3：星级进阶不扣钱。需要查一下。  -- done

4：4进阶5，卡牌名字出现的是4星，不是5星。 -- done

5：最高连胜竞技场和成就不符，竞技信息界面显示17，但成就里显示的是10.
现在没有重现，需要确认查一下。  -- done

6：经验元灵购买也有问题，把我的钱扣了，卡牌没有给，提示是仙币不足。
这个现在没有重现，要确认一下，可能和星级进阶一样，其他地方不同步所导致的。

7：好友删除之后，我再加，就不能加上了，不能显示好友了。重新登陆可以显示，就是实际已经加上了，但是没有显示。
可以互相加为好友，同一个人，可以2个同时出现在界面。
现在不会出现这个情况了，但是其中一方会直接死机。

10：反击规则，是否生效。  -- done

11：好友刷新，每次固定5个，随机规则有问题。

12：系统消息问题：2天后又出现这个消息，不过不能再领取了。

13：战斗中，一个加血卡牌，不停的触发战斗，实际上它已经死了。因为已经看不到血条了，但是可以看到卡牌自己。

15：充值地址的修改测试。 -- done

16: 重启服务是可以重复领取魔石奖励 -- done

======================================================================

1， 在线人数统计 --done
2， 等级流失率 --done
3， 付费率计算，平均付费率
4， 消息列表错误
5.  战报中加入玩家名称  -- done
6. 玩家离开游戏时，保存玩家信息，卡牌信息，竞技信息  -- DONE
7. 检查战斗中得出手顺序问题
8. 爬塔会出现卡死的现象。挑战玩神秘关卡-》胜利-》挑战关卡 
9. 技能升级，扣了技能点，但是技能等级没变化 -- done
10. 竞技排行榜出现两个第一名
11. 任务关卡每天早上第一次进入时，不能扫荡  
12. 战斗中，被aoe节能打死一张卡牌后，元神触发的技能不是死掉的卡牌的技能  -- done
13. 增加签到奖励，卡魂碎片  -- done
14. 玩家创建时间，保存时格式有问题。 --done

抽卡概率
魔道触发的概率
技能升级消耗


合并老高代码，修改了配置表


40：天道爬塔，魔道有时不能出现，这本来是应该可以出现的。   -- done
41：加血技能的判断。  -- done
42：修炼经常掉线的问题。
44：通关奖励，奖励仙币，第一关500，以后每一关增加5点仙币。 -- done. wait the client done


15. 第一次竞技场是，列表没涮出来，重新登录可以   -- done
16. 寻宝，补签，被动洗练，元神双倍消耗，20魔石/次。
	天道重置，200魔石1次。
	其中被动洗练20000铜板，或者20魔石，这要确认  -- done

17. 体力在探索时，莫名奇妙的变成0  -- done
18. 战斗中出现攻击或加血的数值位浮点型。
19. 返回的错误提示信息为英文单词。 
20. 修改通关返回值，拼写错误。 -- done
21. 玩家名称提示信息：只能输入1-6位汉字或数字  -- done

1：关于仙币服务端和客户端总量不同步显示的问题。 -- done
2：：加血技能，为血量最低的加血， 定义：当前血量百分比最低的卡牌。不再是实际血量最低的卡牌。如果都一样，则随机给一个加即可。 -- done
3：清理一遍所有的字符串返回信息。
4：竞技场会有时出现挑战胜利但名字没有发生变化的情况 


5：给player增加一个唯一标识符uuid  -- done
6: 增加数据校验测试接口，返回部分玩家的数据给客户端做校验。及时发现导致不一致的数据的原因


<<<<<<< HEAD

6. 仙丹培养每级上限bug 
7. 首冲三倍魔石奖励 -- done
8. app store 服务端验证 -- done
9. 修改签到bug
10. onPowerGiveEnd 发送了两次

9. onPowerGiveEnd 发送了两次
=======
9. onPowerGiveEnd 发送了两次  --done
>>>>>>> e787ad4142f6dffd7ecbbd2725038a6f331a4203
10.所有游戏资源在到达等级最大值是，读取配置表的下一个值是null的，有可能会导致程序出错
11.角色满级后，不加经验 -- done
12.排名奖励10不见了 -- done
13.四星升五星时，第一次返回的星级有问题
14.竞技排名达到第一名不能达成bug  -- done
15. 探索因体力不足，不能探索时，返回体力校验 -- done
16. 经验卡牌掉落，增加大等级概率 --done
17. 体力赠送同一时间段领取了两次  --done


2014-1-3

1：战斗中，一个加血卡牌，不停的触发战斗，实际上它已经死了。因为已经看不到血条了，但是可以看到卡牌自己。

2：可以互相加为好友，同一个人，可以2个同时出现在界面。（同意好友请求时，判断是否已经是好友）-- done

3：搜索好友，分开，请先输入好友名字。  找不到该玩家。分为这两条。（客户端修改）

4：好友刷新，每次固定5个，随机规则有问题。(1-10的id的玩家不存在)

5：灵气采集概率暴击，这个设定去掉。 -- done

6：抽卡概率70%这个修改，需要确认激活的条件，应该是可激活状态下，而不是需要已经激活的状态下。 （点亮和可点亮卡牌都算已拥有卡牌） -- done

7：记住当前已兑换卡牌的状态  -- done

8: 第一次达成成就是，添加是否第一次标记  --done

9： 12点钟领取体力时，可以无限领取bug  -- done

10: 被动技能洗练，仙币消耗安洗练次数算 -- done

12: 战斗中会出现，显示卡牌已阵亡，但是突然复活了。或者显示卡牌还没死，战斗就已经结束了。

13: dailyGift 的值出现乱码（木丸多次尝试领取体力的bug时出现）



2014-1-7

1：战斗力参数传给竞技界面  -done


2：竞技弹出界面相关的参数传给界面。 -- done


3：第一次战斗结束后，服务端给直接加5000仙币。 -- done


4：卡牌兑换获得5星卡，给予全服通告。 -- done

5：购买经验元灵，增加次数限制，并且与VIP挂钩。 
初始默认可购买30张，每增加1个VIP等级，增加10张购买量。
这样算下来，初始不花钱，140天左右，1张5星满级。 -- done


客户端所需要补充的：1，界面可购买数量显示。2：购买完毕后，提示：今日可购买数量已用完，VIP可购买更多。这个提示方式和灵气采集，体力购买，好友祝福是一个模式。

配置表已配置完毕。已提交。

-- done

6：最后是，月卡和周卡。

2014-1-8

战报出错，卡牌未死亡就已经结束战斗

最高连胜竞技场和成就不符，竞技信息界面显示17，但成就里显示的是10.

经验元灵购买也有问题，把我的钱扣了，卡牌没有给，提示是仙币不足

发放单人系统消息，全部玩家收到了，但是不能领取 -- done

重复加好友的bug --done

五星卡牌进阶成功发送的消息中，卡牌名称改为四星卡牌的名称  --done

2014-1-9


1：70%概率抽取规则修改。从第8张卡开始生效。
初级抽卡需要确认下这个规则是否在生效。
95:5概率比例。  -- done

2：开服之前如果时间还没到，给予一个提示信息。
请您稍候，服务器将在XX点准时开启。 -- done

3：星级进阶不扣钱。  (还没重现)

4：4进阶5，卡牌名字出现的是4星，不是5星。 -- done

5：最高连胜竞技场和成就不符，竞技信息界面显示17，但成就里显示的是10.

<<<<<<< HEAD
SELECT r1.id, r1.name, r1.lv, r1.ability FROM player AS r1 JOIN (SELECT ROUND(RAND() * (SELECT MAX(id) FROM player)) AS id) AS r2 WHERE r1.id not in (100) and r1.id >= r2.id ORDER BY r1.id ASC LIMIT 5;
=======
6：经验元灵购买也有问题，把我的钱扣了，卡牌没有给，提示是仙币不足。 
>>>>>>> e787ad4142f6dffd7ecbbd2725038a6f331a4203
